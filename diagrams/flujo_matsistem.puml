@startuml
title Flujo de Usuario - MatSistem (Generador de Exámenes)
skinparam backgroundColor white
skinparam activity {
  BackgroundColor #e8f5e9
  BorderColor #2e7d32
  ArrowColor #2e7d32
}

start
:Ingresar a la Plataforma;
:Seleccionar Pestaña **"MatSistem"** 
(Módulo de Matemática);

partition "1. Configuración Inicial" {
  :Seleccionar **Grado Escolar**
  (Inicial, Primaria o Secundaria);
  :Seleccionar **Competencia**
  (Ej: Resuelve problemas de cantidad);
  
  if (¿Datos cargados?) then (Sí)
    :Sistema carga **Desempeños** 
    filtrados por Grado y Competencia;
  else (No)
    :Mostrar error de carga;
    stop
  endif
}

partition "2. Selección de Aprendizajes" {
  :Visualizar **Capacidades** (Pestañas);
  note right
    Las competencias se organizan 
    en 4 capacidades fijas
  end note
  
  repeat
    :Seleccionar Pestaña de Capacidad;
    :Marcar **Desempeños** a evaluar
    (Checkboxes);
  repeat while (¿Seleccionar de otra capacidad?)
}

partition "3. Configuración del Examen" {
  :Definir **Cantidad de Preguntas**
  (Slider 1-10);
  
  if (¿Usar Problema Base?) then (Sí)
    :Activar opción **"Usar Problema Base"**;
    if (¿Subir Archivo?) then (Sí)
      :Subir archivo **PDF o Word**;
      :Sistema extrae texto del archivo;
    else (No)
      :Ingresar texto manualmente;
    endif
  else (No)
    :La IA generará la situación
    problemática desde cero;
  endif
}

:Clic en botón **"Generar Examen"**;

partition "Procesamiento (Backend + IA)" {
  :Validar Grado, Competencia y Desempeños;
  :Construir Prompt "MateJony" (Experto MINEDU);
  :Generar **Situación Problemática Integradora**;
  :Generar Preguntas y Alternativas;
  :Generar Tabla de Respuestas;
}

partition "4. Resultados y Exportación" {
  :Visualizar **Vista Previa**;
  note right
    Muestra:
    - Título y Datos
    - Situación Problemática
    - Preguntas
    - Tabla de Respuestas (Solucionario)
  end note
  
  if (¿Conforme con el resultado?) then (Sí)
    :Clic en **"Descargar Word"**;
    :Obtener archivo .docx formateado;
  else (No)
    :Ajustar parámetros o Regenerar;
    stop
  endif
}

stop
@enduml
